# Деплой на Render

Ниже описан способ поднять клиент и сервер из этого репозитория в рамках **одного** веб-сервиса Render. Node-приложение собирает Pixi-клиент, раздаёт статические файлы и держит WebSocket-подключения на том же домене.

## 1. Подготовьте репозиторий

1. Убедитесь, что репозиторий загружен в GitHub/GitLab/Bitbucket и доступен Render.
2. При необходимости добавьте в корень файл `render.yaml` из этого проекта — по нему можно создать сервис в один клик.

## 2. Создание сервиса

### Вариант A. Через blueprint

1. В панели Render нажмите **New + → Blueprint Instance**.
2. Укажите ссылку на репозиторий и выберите файл `render.yaml`.
3. Проверьте значения:
   - **Build Command:** `npm install && npm run build`
   - **Start Command:** `npm run start --workspace server`
   - **Runtime:** Node
4. Нажмите **Apply**. Render создаст веб-сервис `tla-app` с автоматическим деплоем.

### Вариант B. Ручная настройка

1. В панели Render нажмите **New + → Web Service** и подключите репозиторий.
2. Заполните конфигурацию:
   - **Runtime:** Node
   - **Build Command:** `npm install && npm run build`
   - **Start Command:** `npm run start --workspace server`
3. На вкладке **Environment** убедитесь, что стоит переменная `NODE_ENV=production`. Дополнительно можно задать `STATIC_DIR`, если хотите хранить клиентский билд в другом каталоге.
4. Выберите план (Free/Starter) и регион, затем создайте сервис.

## 3. Что происходит при деплое

1. Render выполняет `npm install`, после чего сборка `npm run build` компилирует общий пакет, сервер и клиент.
2. Клиентский бандл попадает в `client/dist`. Во время запуска сервер автоматически раздаёт файлы из этого каталога и слушает WebSocket на том же порту.
3. Браузерное приложение автоматически подключается к `wss://<ваш-домен>`, поэтому отдельная переменная `VITE_WS_URL` не требуется. При желании её можно задать вручную — клиент возьмёт значение из окружения.

## 4. Проверка

1. После успешного деплоя откройте URL сервиса в браузере.
2. Приложение загрузится из `client/dist`, предложит ввести ник и подключится к комнате `demo` через WebSocket на том же домене.
3. В логах Render появятся сообщения о подключении игроков. Если клиент не может подключиться, проверьте логи — возможно, сборка клиента не была создана или переменная `STATIC_DIR` указывает на несуществующую папку.

## 5. Локальное тестирование переменных

Для ручного указания адреса WebSocket во время разработки можно создать `client/.env.local` и задать:

```bash
VITE_WS_URL=ws://localhost:3001
```

В продакшене переменная не нужна, но поддерживается для обратной совместимости.
