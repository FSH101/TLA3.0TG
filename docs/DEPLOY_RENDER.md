# Деплой на Render

Документ описывает пошаговый сценарий создания нового проекта в [Render](https://render.com) для запуска WebSocket-сервера и статического клиента из этого репозитория.

## 1. Подготовка репозитория

1. Убедитесь, что репозиторий загружен в GitHub/GitLab/Bitbucket и доступен Render.
2. Создайте ветку с актуальными изменениями и убедитесь, что `render.yaml` находится в корне репозитория.
3. При необходимости укажите публичный адрес WebSocket-сервера в переменной окружения `VITE_WS_URL` (см. ниже).

## 2. Создание WebSocket-сервиса (Node.js)

1. В панели Render нажмите **New +** → **Web Service**.
2. Выберите «Build & deploy from a Git repository» и подключите репозиторий.
3. На шаге конфигурации Render автоматически найдёт блок `tla-server` в `render.yaml`. Убедитесь, что значения подгрузились:
   - **Runtime:** Node
   - **Build Command:** `npm install && npm run build --workspace shared && npm run build --workspace server`
   - **Start Command:** `npm run start --workspace server`
4. Выберите подходящий план (Free/Stater) и регион.
5. Задайте переменные окружения (кнопка **Advanced → Add Environment Variable**):
   - `NODE_ENV=production`
   - `PORT` — Render проставит автоматически, оставьте пустым (сервер читает `process.env.PORT`).
6. Завершите создание. После первого билда Render выдаст URL вида `https://tla-server.onrender.com`. Скопируйте его — он понадобится клиенту.

## 3. Создание статического клиента

1. В панели Render нажмите **New +** → **Static Site**.
2. Подключите тот же репозиторий. Render подставит блок `tla-client` из `render.yaml`:
   - **Build Command:** `npm install && npm run build --workspace client`
   - **Publish Directory:** `client/dist`
3. На вкладке **Environment** добавьте переменную `VITE_WS_URL` со значением `wss://<ваш-домен-сервера>`. Шаблон в `render.yaml` содержит заглушку `wss://REPLACE_WITH_SERVER_HOST.onrender.com` — замените её перед деплоем или сразу после создания сервиса.
4. Завершите создание. После билда вы получите URL клиентской PWA.

## 4. Проверка

1. Откройте клиентский URL. При первом запуске приложение спросит ник и подключится к комнате `demo`.
2. В консоли сервера Render появятся логи подключения.
3. При проблемах проверьте, что `VITE_WS_URL` указывает на `wss://` и домен сервера, а сам сервер успешно стартует.

## 5. Локальные переменные окружения

Для локальной разработки можно создать файл `client/.env.local` со строкой:

```bash
VITE_WS_URL=ws://localhost:3001
```

Это позволит явно управлять адресом WebSocket при тестировании, не полагаясь на автоопределение порта.

## 6. Обновление деплоя

При пуше в выбранную ветку Render автоматически пересоберёт обе службы. При изменении переменной `VITE_WS_URL` не забудьте redeploy статический сайт.

