# Работа с FRM-ассетами

В будущих обновлениях планируется использовать оригинальные спрайты Fallout в формате `.frm`. Этот документ описывает подготовленные в проекте точки расширения и рекомендуемый рабочий процесс.

## 1. Импорт и типы

- Vite настроен на распознавание файлов `.frm` как статических ресурсов. Благодаря объявлению модулей в `client/src/vite-env.d.ts` можно импортировать файл как URL, строку или `ArrayBuffer`:
  ```ts
  import unitUrl from "./unit.frm?url";
  import unitData from "./unit.frm?arraybuffer";
  ```
- В TypeScript можно описывать высокоуровневые данные FRM в общих типах (`shared`) без подключения бинарников к репозиторию.

## 2. Рекомендуемый пайплайн

1. Сохраните оригинальные `.frm` в локальную директорию (например, `assets/frm`), но не коммитьте их в репозиторий.
2. Для предпросмотра используйте вспомогательный скрипт (например, Node.js + Canvas) либо внешние утилиты, чтобы конвертировать `.frm` в PNG/SVG при необходимости.
3. Готовые JSON-описания анимаций и метаданных можно хранить в `assets/` как текстовые файлы, совместимые с редактором карт.
4. При загрузке клиента используйте `fetch` + `ArrayBuffer`, чтобы преобразовать данные во временные `Texture`/`Spritesheet` PixiJS. Поскольку бинарные ассеты не попадают в Git, их можно доставлять с CDN или приватного хранилища.

## 3. Плейсхолдеры в коде

- В клиенте уже используются процедурно сгенерированные текстуры-заглушки. Их легко заменить при появлении реальных FRM-данных: достаточно обновить фабрику тайлов и маркеров.
- В редакторе карт идентификаторы тайлов (`tile_placeholder`) хранятся как текст. Это позволит позже подставить реальные имена FRM-кадров без изменения формата карты.

## 4. Инструменты для дальнейшей автоматизации

- Создание npm-скрипта для пакетной конвертации `.frm` → `.json`/`.png`.
- Генерация атласов (SpriteSheet) из набора `.frm` с сохранением индексов в `assets`.
- Интеграция с будущим `AssetRegistry`, который сможет резолвить FRM по текстовым идентификаторам и кешировать текстуры на клиенте.

Полное описание бинарного формата доступно в вики: <https://falloutmods.fandom.com/wiki/FRM_File_Format>.

## 5. Демонстрационная анимация

- В каталоге `client/src/assets/intro.frm` лежит текстовое представление (`schema: pipboy-frm-v1`) простого FRM, которое используется на экране входа. Документ содержит метаданные (`width`, `height`, `fps`), палитру (RGBA) и массив кадров с base64-представлением индексов.
- Модуль `client/src/lib/frm.ts` умеет преобразовывать такой JSON в `ImageData` и воспроизводит анимацию через Canvas 2D (`playFrmAnimation`). Это упрощённый, но расширяемый путь: парсер можно дополнить поддержкой бинарного `.frm`, сохранив API.
- Для предварительного просмотра можно создать свои `.frm`-описания и подключать их через `import asset from "./file.frm?raw"` без добавления бинарников в репозиторий.

