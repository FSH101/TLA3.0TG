# Прототип гексагонального клиента TLA

Экспериментальный онлайн-прототип с гексагональной сеткой: клиент на PixiJS и сервер на Node.js с WebSocket. Монорепозиторий состоит из трёх рабочих пространств: `client`, `server` и `shared`.

## Предварительные требования

- Node.js 20+
- npm 9+

## Быстрый старт

Установите зависимости во всех рабочих пространствах:

```bash
npm install
```

### Разработка

Запустите клиент и сервер в режиме разработки одновременно:

```bash
npm run dev
```

- Клиент: http://localhost:5173
- Сервер: ws://localhost:3001

### Сборка

Создайте production-сборки для общих пакетов, сервера и клиента:

```bash
npm run build
```

Просмотрите собранный клиентский бандл:

```bash
npm run preview
```

### Тесты

Запустите модульные тесты для гексагональной сетки в `shared`:

```bash
npm run test
```

### Архив проекта

Создайте `.zip`-архив без бинарных артефактов (node_modules, dist и пр.):

```bash
npm run archive
```

Готовый файл будет лежать в `artifacts/project.zip`.

## Структура проекта

```
.
├── client      # фронтенд на Vite + PixiJS (PWA)
├── server      # авторитетный сервер на Node.js WebSocket
├── shared      # общие типы и утилиты работы с сеткой на TypeScript
├── assets      # заготовка для будущих ассетов
└── docs        # документация по формату карт и протоколу
```

## Возможности

- Гексагональная сетка 64×64 в изометрическом ромбе.
- Панорамирование и масштабирование мышью или жестами (щипок).
- Выбор клетки перемещает локальный маркер и рассылает позицию другим игрокам.
- Встроенный редактор карт с инструментами рисования/стирания, импортом/экспортом JSON и сохранением PNG.
- Адаптивный интерфейс с экранами входа, регистрации и создания персонажа, а также полноэкранной подсказкой на мобильных устройствах.
- Клиент готов к офлайн-режиму благодаря service worker и манифесту.

Дополнительные подробности см. в файлах [MAP_FORMAT.md](docs/MAP_FORMAT.md) и [PROTOCOL.md](docs/PROTOCOL.md).

## Деплой на Render

- Используйте blueprint [render.yaml](render.yaml), чтобы создать **один** веб-сервис в Render: он собирает клиент и сервер и обслуживает статику с того же домена. Команда сборки в blueprint-файле уже включает `npm install --include=dev`, поэтому TypeScript и типы устанавливаются даже при `NODE_ENV=production`.
- Подробный пошаговый сценарий настройки описан в [DEPLOY_RENDER.md](docs/DEPLOY_RENDER.md).
- Переменная окружения `VITE_WS_URL` теперь опциональна — по умолчанию клиент подключается к WebSocket на том же хосте, что и фронтенд.

## Подготовка к FRM-ассетам

- Клиентская сборка понимает импорт файлов `.frm` как URL, текст или `ArrayBuffer`, что позволяет хранить бинарники вне репозитория.
- В [FRM_ASSETS.md](docs/FRM_ASSETS.md) описан рекомендуемый пайплайн для конвертации и подключения спрайтов Fallout.
